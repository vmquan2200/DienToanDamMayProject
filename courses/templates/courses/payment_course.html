{% extends 'courses/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<!-- Breadcrumb Section -->
<div class="breadcrumb-optimized" id="breadcrumb">
    <div class="container">
        <div class="payment-guide-breadcrumb">
            <a href="/" class="crumb">
                <span>üè†</span>
                <span>Trang ch·ªß</span>
            </a>
            <div class="crumb-separator">‚Ä∫</div>
            <a href="{% url 'checkout' %}" class="crumb">
                <span>üõí</span>
                <span>Thanh to√°n</span>
            </a>
            <div class="crumb-separator">‚Ä∫</div>
            <div class="crumb current">
                <span>üìñ</span>
                <span>H∆∞·ªõng d·∫´n thanh to√°n</span>
            </div>
        </div>
    </div>
</div>

<div class="payment-guide-container">
    <div class="payment-guide-wrapper">
        <div class="payment-guide-header">
            <div class="payment-method-badge">
                {% if payment_method == 'momo' %}
                <span class="method-icon">üì±</span>
                <span class="method-name">MoMo</span>
                {% elif payment_method == 'banking' %}
                <span class="method-icon">üè¶</span>
                <span class="method-name">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</span>
                {% endif %}
            </div>
            <h1>H∆∞·ªõng d·∫´n thanh to√°n</h1>
            <p class="guide-subtitle">L√†m theo c√°c b∆∞·ªõc b√™n d∆∞·ªõi ƒë·ªÉ ho√†n t·∫•t thanh to√°n</p>
        </div>

        <div class="payment-guide-card">
            <div class="guide-content">
                {% if payment_method == 'momo' %}
                <!-- MoMo Guide -->
                <div class="guide-grid">
                    <div class="qr-section">
                        <div class="qr-display">
                            <div class="qr-frame">
                                <img src="{% static 'courses/images/momo-qr.png' %}" alt="MoMo QR" class="qr-image">
                                <div class="qr-overlay">
                                    <span class="qr-app">MoMo</span>
                                    <span class="qr-hint">Qu√©t ƒë·ªÉ thanh to√°n</span>
                                </div>
                            </div>
                            <div class="qr-meta">
                                <div class="meta-item">
                                    <span class="meta-icon">üí∞</span>
                                    <span class="meta-text">{{ total_amount|floatformat:0|intcomma }} VNƒê</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-icon">üïí</span>
                                    <span class="meta-text">X√°c nh·∫≠n trong 5 ph√∫t</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="qr-tips">
                            <div class="tip">
                                <span class="tip-icon">üì±</span>
                                <span>M·ªü ·ª©ng d·ª•ng MoMo ƒë·ªÉ qu√©t</span>
                            </div>
                            <div class="tip">
                                <span class="tip-icon">üí°</span>
                                <span>ƒê·∫£m b·∫£o ƒë·ªß s·ªë d∆∞ trong v√≠</span>
                            </div>
                        </div>
                    </div>

                    <div class="steps-section">
                        <div class="steps-header">
                            <h2><span>üìã</span> H∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc</h2>
                            <p>Th·ª±c hi·ªán ƒë√∫ng tr√¨nh t·ª± ƒë·ªÉ thanh to√°n th√†nh c√¥ng</p>
                        </div>
                        
                        <div class="steps-list">
                            <div class="step-item">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h3>M·ªü ·ª©ng d·ª•ng MoMo</h3>
                                    <p>Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng MoMo tr√™n ƒëi·ªán tho·∫°i v√† ƒëƒÉng nh·∫≠p v√†o t√†i kho·∫£n c·ªßa b·∫°n</p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h3>Ch·ªçn t√≠nh nƒÉng qu√©t m√£</h3>
                                    <p>Tr√™n m√†n h√¨nh ch√≠nh, ch·ªçn bi·ªÉu t∆∞·ª£ng "Qu√©t m√£ QR" ho·∫∑c v√†o m·ª•c "Thanh to√°n" ‚Üí "Qu√©t m√£"</p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h3>Qu√©t m√£ QR</h3>
                                    <p>ƒê∆∞a camera v·ªÅ ph√≠a m√£ QR b√™n tr√°i, ƒë·∫£m b·∫£o m√£ n·∫±m trong khung qu√©t</p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h3>X√°c nh·∫≠n thanh to√°n</h3>
                                    <p>Ki·ªÉm tra s·ªë ti·ªÅn <strong>{{ total_amount|floatformat:0|intcomma }} VNƒê</strong> v√† nh·∫•n "X√°c nh·∫≠n thanh to√°n"</p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h3>Ho√†n t·∫•t ƒë∆°n h√†ng</h3>
                                    <p>Sau khi thanh to√°n th√†nh c√¥ng, quay l·∫°i trang n√†y v√† nh·∫•n n√∫t "T√¥i ƒë√£ thanh to√°n"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% elif payment_method == 'banking' %}
                <!-- Banking Guide -->
                <div class="guide-grid">
                    <div class="qr-section">
                        <div class="qr-display">
                            <div class="qr-frame">
                                <img src="{% static 'courses/images/bank-qr.png' %}" alt="Bank QR" class="qr-image">
                                <div class="qr-overlay">
                                    <span class="qr-app">VietinBank</span>
                                    <span class="qr-hint">Qu√©t ƒë·ªÉ chuy·ªÉn kho·∫£n</span>
                                </div>
                            </div>
                            <div class="qr-meta">
                                <div class="meta-item">
                                    <span class="meta-icon">üí∞</span>
                                    <span class="meta-text">{{ total_amount|floatformat:0|intcomma }} VNƒê</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-icon">‚è±Ô∏è</span>
                                    <span class="meta-text">X√°c nh·∫≠n trong 10 ph√∫t</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bank-info">
                            <div class="info-header">
                                <span class="info-icon">üè¶</span>
                                <h3>Th√¥ng tin t√†i kho·∫£n</h3>
                            </div>
                            <div class="info-grid">
                                <div class="info-item" data-copy="VietinBank">
                                    <span class="info-label">Ng√¢n h√†ng</span>
                                    <span class="info-value">VietinBank</span>
                                </div>
                                <div class="info-item" data-copy="0396870877">
                                    <span class="info-label">S·ªë t√†i kho·∫£n</span>
                                    <span class="info-value">0396870877</span>
                                </div>
                                <div class="info-item" data-copy="LE TRAN VU">
                                    <span class="info-label">Ch·ªß t√†i kho·∫£n</span>
                                    <span class="info-value">LE TRAN VU</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Chi nh√°nh</span>
                                    <span class="info-value">HCM</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="steps-section">
                        <div class="steps-header">
                            <h2><span>üè¶</span> H∆∞·ªõng d·∫´n chuy·ªÉn kho·∫£n</h2>
                            <p>L√†m theo c√°c b∆∞·ªõc ƒë·ªÉ chuy·ªÉn kho·∫£n th√†nh c√¥ng</p>
                        </div>
                        
                        <div class="steps-list">
                            <div class="step-item">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h3>M·ªü ·ª©ng d·ª•ng ng√¢n h√†ng</h3>
                                    <p>Truy c·∫≠p ·ª©ng d·ª•ng Internet Banking ho·∫∑c Mobile Banking c·ªßa ng√¢n h√†ng b·∫°n ƒëang s·ª≠ d·ª•ng</p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h3>Ch·ªçn ch·ª©c nƒÉng chuy·ªÉn ti·ªÅn</h3>
                                    <p>V√†o m·ª•c "Chuy·ªÉn kho·∫£n" ‚Üí "Chuy·ªÉn ti·ªÅn nhanh 24/7" ho·∫∑c "QR Transfer" n·∫øu c√≥</p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h3>Qu√©t m√£ QR ho·∫∑c nh·∫≠p th·ªß c√¥ng</h3>
                                    <p>Qu√©t m√£ QR b√™n tr√°i ho·∫∑c nh·∫≠p th√¥ng tin t√†i kho·∫£n theo h∆∞·ªõng d·∫´n</p>
                                    <div class="note-box">
                                        <strong>L∆∞u √Ω:</strong> N·∫øu nh·∫≠p th·ªß c√¥ng, vui l√≤ng nh·∫≠p ch√≠nh x√°c s·ªë t√†i kho·∫£n v√† t√™n ng∆∞·ªùi nh·∫≠n
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h3>Nh·∫≠p s·ªë ti·ªÅn v√† n·ªôi dung</h3>
                                    <p>Nh·∫≠p s·ªë ti·ªÅn <strong>{{ total_amount|floatformat:0|intcomma }} VNƒê</strong> v√† n·ªôi dung: <code>THANH TOAN KHOAHOC</code></p>
                                </div>
                            </div>
                            
                            <div class="step-item">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h3>X√°c nh·∫≠n v√† ho√†n t·∫•t</h3>
                                    <p>X√°c nh·∫≠n th√¥ng tin v√† nh·∫≠p OTP ƒë·ªÉ ho√†n t·∫•t giao d·ªãch. Quay l·∫°i trang n√†y v√† b·∫•m "T√¥i ƒë√£ thanh to√°n"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="empty-guide">
                    <span class="empty-icon">‚ö†Ô∏è</span>
                    <h2>Ph∆∞∆°ng th·ª©c thanh to√°n kh√¥ng kh·∫£ d·ª•ng</h2>
                    <p>Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n kh√°c</p>
                    <a href="{% url 'checkout' %}" class="btn-back">‚Üê Quay l·∫°i thanh to√°n</a>
                </div>
                {% endif %}
            </div>

            <!-- Order Summary -->
            <div class="order-summary-section">
                <div class="summary-header">
                    <span>üìã</span>
                    <h3>Chi ti·∫øt ƒë∆°n h√†ng</h3>
                </div>
                
                <div class="order-items">
                    {% for item in cart_items %}
                    <div class="order-item">
                        <div class="item-info">
                            <span class="item-title">{{ item.course.title }}</span>
                            <span class="item-price">{{ item.course.price|floatformat:0|intcomma }} VNƒê</span>
                        </div>
                        <div class="item-meta">
                            <span class="meta-tag">Kh√≥a h·ªçc</span>
                            <span class="meta-tag">Truy c·∫≠p tr·ªçn ƒë·ªùi</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="order-total">
                    <div class="total-row">
                        <span>T·ªïng ti·ªÅn:</span>
                        <span class="total-amount">{{ total_amount|floatformat:0|intcomma }} VNƒê</span>
                    </div>
                    <div class="total-row discount">
                        <span>Gi·∫£m gi√°:</span>
                        <span class="discount-amount">0 VNƒê</span>
                    </div>
                    <div class="total-row final">
                        <span>Thanh to√°n:</span>
                        <span class="final-amount">{{ total_amount|floatformat:0|intcomma }} VNƒê</span>
                    </div>
                </div>
                
                <div class="payment-actions">
                    <form method="post" action="{% url 'payment_confirm' %}" class="action-form">
                        {% csrf_token %}
                        <input type="hidden" name="payment_method" value="{{ payment_method }}" />
                        <button type="submit" class="btn-confirm">
                            <span>‚úÖ</span>
                            <span>T√¥i ƒë√£ thanh to√°n</span>
                        </button>
                    </form>
                    <a href="{% url 'checkout' %}" class="btn-back">
                        <span>‚Üê</span>
                        <span>Quay l·∫°i thanh to√°n</span>
                    </a>
                </div>
                
                <div class="support-section">
                    <div class="support-header">
                        <span>üíÅ</span>
                        <h4>C·∫ßn h·ªó tr·ª£?</h4>
                    </div>
                    <div class="support-content">
                        <p>N·∫øu b·∫°n g·∫∑p v·∫•n ƒë·ªÅ trong qu√° tr√¨nh thanh to√°n:</p>
                        <ul class="support-list">
                            <li>üìß Email: support@example.com</li>
                            <li>üìû Hotline: 1900 1234</li>
                            <li>üí¨ Chat tr·ª±c tuy·∫øn (9:00 - 21:00)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="faq-section">
            <h2><span>‚ùì</span> C√¢u h·ªèi th∆∞·ªùng g·∫∑p</h2>
            <div class="faq-grid">
                <div class="faq-item">
                    <h3>Sau khi thanh to√°n bao l√¢u th√¨ t√¥i nh·∫≠n ƒë∆∞·ª£c kh√≥a h·ªçc?</h3>
                    <p>H·ªá th·ªëng t·ª± ƒë·ªông x√°c nh·∫≠n trong v√≤ng 5-10 ph√∫t sau khi thanh to√°n th√†nh c√¥ng. B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c email th√¥ng b√°o v√† kh√≥a h·ªçc s·∫Ω xu·∫•t hi·ªán trong m·ª•c "Kh√≥a h·ªçc c·ªßa t√¥i".</p>
                </div>
                <div class="faq-item">
                    <h3>T√¥i c√≥ th·ªÉ thanh to√°n b·∫±ng ph∆∞∆°ng th·ª©c kh√°c kh√¥ng?</h3>
                    <p>C√≥, b·∫°n c√≥ th·ªÉ quay l·∫°i trang thanh to√°n ƒë·ªÉ ch·ªçn ph∆∞∆°ng th·ª©c kh√°c nh∆∞ th·∫ª Visa/Mastercard ho·∫∑c v√≠ ƒëi·ªán t·ª≠ kh√°c.</p>
                </div>
                <div class="faq-item">
                    <h3>N·∫øu t√¥i chuy·ªÉn nh·∫ßm s·ªë ti·ªÅn th√¨ sao?</h3>
                    <p>Vui l√≤ng li√™n h·ªá ngay v·ªõi b·ªô ph·∫≠n h·ªó tr·ª£ qua email ho·∫∑c hotline ƒë·ªÉ ƒë∆∞·ª£c h∆∞·ªõng d·∫´n x·ª≠ l√Ω. Ch√∫ng t√¥i s·∫Ω h·ªó tr·ª£ b·∫°n trong v√≤ng 24 gi·ªù.</p>
                </div>
                <div class="faq-item">
                    <h3>T√¥i c√≥ nh·∫≠n ƒë∆∞·ª£c h√≥a ƒë∆°n VAT kh√¥ng?</h3>
                    <p>C√≥, sau khi thanh to√°n th√†nh c√¥ng, b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c h√≥a ƒë∆°n ƒëi·ªán t·ª≠ (E-invoice) qua email trong v√≤ng 24 gi·ªù.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification -->
<div id="notification" class="notification">
    <div class="notification-content">
        <span class="notification-icon">‚úÖ</span>
        <span class="notification-text"></span>
    </div>
</div>

<style>
:root {
    --primary: #3b82f6;
    --primary-dark: #2563eb;
    --success: #10b981;
    --warning: #f59e0b;
    --info: #0ea5e9;
    --text: #1e293b;
    --text-light: #64748b;
    --bg: #f8fafc;
    --card: #ffffff;
    --border: #e2e8f0;
    --shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
    --radius: 16px;
    --radius-sm: 12px;
    --radius-lg: 24px;
    --transition: all 0.3s ease;
}

/* Breadcrumb - T·ª´ file cart */
.breadcrumb-optimized {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 1rem 0;
    border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    transition: var(--transition);
}

.breadcrumb-optimized.sticky {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 0.75rem 0;
    background: rgba(255, 255, 255, 0.98);
}

.breadcrumb-optimized .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.payment-guide-breadcrumb {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95rem;
    background: white;
    border-radius: 12px;
    padding: 0.75rem 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    transition: var(--transition);
}

.breadcrumb-optimized.sticky .payment-guide-breadcrumb {
    padding: 0.5rem 1.25rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.crumb {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    padding: 6px 12px;
    border-radius: 8px;
    transition: var(--transition);
}

.crumb:hover {
    background: rgba(59, 130, 246, 0.1);
    transform: translateY(-1px);
}

.crumb.current {
    color: var(--text);
    font-weight: 600;
    cursor: default;
    background: #f8fafc;
}

.crumb-separator {
    color: var(--text-light);
}

/* Payment Guide Container */
.payment-guide-container {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    min-height: calc(100vh - 80px);
    padding: 40px 20px;
}

.payment-guide-wrapper {
    max-width: 1200px;
    margin: 0 auto;
}

/* Header */
.payment-guide-header {
    text-align: center;
    margin-bottom: 40px;
}

.payment-method-badge {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    padding: 12px 24px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 20px;
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
}

.method-icon {
    font-size: 1.3rem;
}

.payment-guide-header h1 {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 10px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.guide-subtitle {
    color: var(--text-light);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
}

/* Main Card */
.payment-guide-card {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
}

@media (max-width: 992px) {
    .payment-guide-card {
        grid-template-columns: 1fr;
    }
}

.guide-content {
    background: var(--card);
    border-radius: var(--radius-lg);
    padding: 30px;
    box-shadow: var(--shadow);
}

/* QR Section */
.guide-grid {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 30px;
}

@media (max-width: 768px) {
    .guide-grid {
        grid-template-columns: 1fr;
    }
}

.qr-section {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.qr-display {
    text-align: center;
}

.qr-frame {
    position: relative;
    display: inline-block;
    background: white;
    padding: 20px;
    border-radius: var(--radius);
    border: 2px solid var(--border);
    box-shadow: var(--shadow);
}

.qr-image {
    width: 240px;
    height: 240px;
    display: block;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.qr-image:hover {
    transform: scale(1.02);
}

.qr-overlay {
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--card);
    padding: 10px 20px;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border);
}

.qr-app {
    font-weight: 700;
    color: var(--primary);
}

.qr-hint {
    color: var(--text-light);
    font-size: 0.9rem;
}

.qr-meta {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #f1f5f9;
    padding: 10px 16px;
    border-radius: var(--radius-sm);
}

.meta-icon {
    font-size: 1.2rem;
}

.meta-text {
    font-weight: 600;
    color: var(--text);
    font-variant-numeric: tabular-nums;
}

/* Tips */
.qr-tips {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.tip {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: #f0f9ff;
    border-radius: var(--radius-sm);
    border-left: 4px solid var(--primary);
}

.tip-icon {
    font-size: 1.2rem;
}

/* Bank Info */
.bank-info {
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border-radius: var(--radius);
    padding: 20px;
    border: 2px solid #bae6fd;
}

.info-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
}

.info-header h3 {
    color: var(--text);
    margin: 0;
}

.info-icon {
    font-size: 1.5rem;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

@media (max-width: 480px) {
    .info-grid {
        grid-template-columns: 1fr;
    }
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
    padding: 12px;
    background: white;
    border-radius: var(--radius-sm);
    border: 2px solid transparent;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
}

.info-item:hover {
    border-color: var(--primary);
    background: #f8fafc;
    transform: translateY(-2px);
}

.info-item[data-copy]::after {
    content: 'üìã';
    position: absolute;
    top: 8px;
    right: 8px;
    opacity: 0;
    transition: var(--transition);
    font-size: 0.9rem;
}

.info-item[data-copy]:hover::after {
    opacity: 1;
}

.info-label {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 500;
}

.info-value {
    font-weight: 700;
    color: var(--text);
    font-size: 1.1rem;
    font-variant-numeric: tabular-nums;
}

/* Steps Section */
.steps-section {
    padding: 10px;
}

.steps-header {
    margin-bottom: 30px;
}

.steps-header h2 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    color: var(--text);
    margin-bottom: 8px;
}

.steps-header p {
    color: var(--text-light);
}

.steps-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.step-item {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: #f8fafc;
    border-radius: var(--radius);
    border: 2px solid transparent;
    transition: var(--transition);
}

.step-item:hover {
    border-color: var(--primary);
    background: white;
    transform: translateX(5px);
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    font-weight: 800;
    font-size: 1.2rem;
    flex-shrink: 0;
}

.step-content {
    flex: 1;
}

.step-content h3 {
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 8px;
}

.step-content p {
    color: var(--text-light);
    line-height: 1.5;
    margin-bottom: 10px;
}

.step-content strong {
    color: var(--success);
    font-weight: 700;
}

.note-box {
    background: #fff7ed;
    border-left: 4px solid #f97316;
    padding: 12px 15px;
    border-radius: 8px;
    font-size: 0.95rem;
    color: #92400e;
    margin-top: 10px;
}

.note-box strong {
    color: #ea580c;
}

/* Order Summary */
.order-summary-section {
    background: var(--card);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
    align-self: start;
    position: sticky;
    top: 100px;
}

.summary-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
}

.summary-header h3 {
    color: var(--text);
    margin: 0;
    font-size: 1.3rem;
}

.order-items {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
}

.order-item {
    padding: 15px;
    background: #f8fafc;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
}

.item-info {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.item-title {
    font-weight: 600;
    color: var(--text);
    flex: 1;
    margin-right: 15px;
}

.item-price {
    font-weight: 700;
    color: var(--primary);
    flex-shrink: 0;
    font-variant-numeric: tabular-nums;
}

.item-meta {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.meta-tag {
    background: #e0f2fe;
    color: #0369a1;
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: 500;
}

.order-total {
    border-top: 2px solid var(--border);
    padding-top: 20px;
    margin-bottom: 25px;
}

.total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    color: var(--text);
}

.total-row.discount {
    color: var(--text-light);
}

.total-row.final {
    font-size: 1.3rem;
    font-weight: 800;
    color: var(--text);
    padding-top: 10px;
    border-top: 1px solid var(--border);
    margin-top: 15px;
}

.total-amount,
.final-amount {
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.5px;
}

.final-amount {
    color: var(--success);
    text-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
}

.discount-amount {
    color: var(--text-light);
}

/* Payment Actions */
.payment-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
}

.action-form {
    width: 100%;
}

.btn-confirm {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    width: 100%;
    padding: 18px;
    background: linear-gradient(135deg, var(--success), #34d399);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 700;
    text-decoration: none;
    transition: var(--transition);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    cursor: pointer;
}

.btn-confirm:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(16, 185, 129, 0.4);
}

.btn-back {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 15px;
    background: var(--card);
    color: var(--primary);
    border: 2px solid var(--primary);
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: var(--transition);
}

.btn-back:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
}

/* Support Section */
.support-section {
    background: #f0f9ff;
    border-radius: var(--radius);
    padding: 20px;
    border: 2px solid #bae6fd;
}

.support-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.support-header h4 {
    color: var(--text);
    margin: 0;
}

.support-content p {
    color: var(--text-light);
    margin-bottom: 12px;
    font-size: 0.95rem;
}

.support-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.support-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    color: var(--text);
    font-size: 0.95rem;
}

/* FAQ Section */
.faq-section {
    background: var(--card);
    border-radius: var(--radius);
    padding: 40px;
    box-shadow: var(--shadow);
}

.faq-section h2 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.8rem;
    color: var(--text);
    margin-bottom: 30px;
    text-align: center;
    justify-content: center;
}

.faq-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
}

@media (max-width: 768px) {
    .faq-grid {
        grid-template-columns: 1fr;
    }
}

.faq-item {
    padding: 25px;
    background: #f8fafc;
    border-radius: var(--radius);
    border: 2px solid transparent;
    transition: var(--transition);
}

.faq-item:hover {
    border-color: var(--primary);
    background: white;
    transform: translateY(-5px);
}

.faq-item h3 {
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 12px;
    line-height: 1.4;
}

.faq-item p {
    color: var(--text-light);
    line-height: 1.6;
    margin: 0;
}

/* Empty Guide */
.empty-guide {
    text-align: center;
    padding: 60px 40px;
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.3;
}

.empty-guide h2 {
    font-size: 1.8rem;
    color: var(--text);
    margin-bottom: 15px;
}

.empty-guide p {
    color: var(--text-light);
    margin-bottom: 30px;
}

/* Notification */
.notification {
    position: fixed;
    top: 100px;
    right: 20px;
    z-index: 1000;
    background: white;
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-lg);
    border-left: 5px solid var(--success);
    transform: translateX(120%);
    transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    max-width: 400px;
}

.notification.show {
    transform: translateX(0);
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.notification-icon {
    font-size: 1.5rem;
}

.notification-text {
    font-weight: 600;
    color: var(--text);
}

/* Responsive */
@media (max-width: 768px) {
    .payment-guide-header h1 {
        font-size: 2rem;
    }
    
    .payment-method-badge {
        padding: 10px 20px;
        font-size: 1rem;
    }
    
    .payment-guide-card,
    .guide-content {
        padding: 20px;
    }
    
    .qr-image {
        width: 200px;
        height: 200px;
    }
    
    .step-item {
        padding: 15px;
    }
    
    /* Responsive breadcrumb */
    .payment-guide-breadcrumb {
        padding: 0.75rem 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .crumb span:last-child {
        display: none;
    }
    
    .crumb {
        padding: 0.5rem;
    }
}

@media (max-width: 480px) {
    .payment-guide-header h1 {
        font-size: 1.8rem;
    }
    
    .faq-section {
        padding: 25px;
    }
    
    .qr-image {
        width: 180px;
        height: 180px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sticky breadcrumb effect
    const breadcrumb = document.getElementById('breadcrumb');
    if (breadcrumb) {
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                breadcrumb.classList.add('sticky');
            } else {
                breadcrumb.classList.remove('sticky');
            }
        });
    }

    // Copy bank account info on click
    const copyItems = document.querySelectorAll('.info-item[data-copy]');
    copyItems.forEach(item => {
        item.addEventListener('click', function() {
            const text = this.getAttribute('data-copy');
            navigator.clipboard?.writeText(text).then(() => {
                showNotification(`ƒê√£ sao ch√©p: ${text}`);
            });
        });
    });

    // Form submission loading state
    const confirmForm = document.querySelector('.action-form');
    if (confirmForm) {
        confirmForm.addEventListener('submit', function(e) {
            // mark that after any redirect/return we should scroll to breadcrumb
            try {
                sessionStorage.setItem('scroll_to_breadcrumb', '1');
            } catch (err) {
                // ignore
            }

            const btn = this.querySelector('.btn-confirm');
            if (btn) {
                btn.innerHTML = '<span>‚è≥</span><span>ƒêang x·ª≠ l√Ω...</span>';
                btn.disabled = true;
                setTimeout(() => {
                    btn.innerHTML = '<span>‚úÖ</span><span>ƒêang chuy·ªÉn h∆∞·ªõng...</span>';
                }, 1000);
            }
        });
    }

    // Expand FAQ items on click
    const faqItems = document.querySelectorAll('.faq-item');
    faqItems.forEach(item => {
        item.addEventListener('click', function() {
            this.classList.toggle('expanded');
        });
    });

    // Show notification function
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        const text = notification.querySelector('.notification-text');
        const icon = notification.querySelector('.notification-icon');
        
        text.textContent = message;
        
        if (type === 'error') {
            notification.style.borderLeftColor = 'var(--danger)';
            icon.textContent = '‚ùå';
        } else {
            notification.style.borderLeftColor = 'var(--success)';
            icon.textContent = '‚úÖ';
        }
        
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Add animation to steps on scroll
    const observerOptions = {
        threshold: 0.2,
        rootMargin: '0px 0px -50px 0px'
    };

    const stepObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateX(0)';
            }
        });
    }, observerOptions);

    // Apply animation to step items
    const stepItems = document.querySelectorAll('.step-item');
    stepItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateX(-20px)';
        item.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        item.style.transitionDelay = `${index * 0.1}s`;
        stepObserver.observe(item);
    });

    // QR code download functionality
    const qrImages = document.querySelectorAll('.qr-image');
    qrImages.forEach(img => {
        img.addEventListener('click', function() {
            const link = document.createElement('a');
            link.href = this.src;
            link.download = `qr_thanhtoan_${Date.now()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('ƒê√£ t·∫£i xu·ªëng m√£ QR');
        });
    });

    // Format all currency elements with JavaScript fallback
    function formatCurrency(number) {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    // Fallback formatting for any element that might miss Django formatting
    document.querySelectorAll('.meta-text, .total-amount, .final-amount, .item-price').forEach(el => {
        if (el.textContent.includes('VNƒê')) {
            const match = el.textContent.match(/([\d,\.]+)/);
            if (match) {
                // Remove existing dots/commas, then format
                const numberStr = match[1].replace(/[.,]/g, '');
                const number = parseInt(numberStr);
                if (!isNaN(number)) {
                    const formatted = formatCurrency(number);
                    el.textContent = el.textContent.replace(match[1], formatted);
                }
            }
        }
    });

    // If the user just confirmed payment (or returned from a provider), auto-scroll to breadcrumb
    try {
        if (sessionStorage.getItem('scroll_to_breadcrumb')) {
            const bc = document.getElementById('breadcrumb');
            if (bc) {
                setTimeout(() => {
                    bc.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 120);
            }
            sessionStorage.removeItem('scroll_to_breadcrumb');
        }

        // Also support direct landing when clicking a payment method link like '?method=banking' or '?method=momo'
        const params = new URLSearchParams(window.location.search);
        const methodParam = (params.get('method') || '').toLowerCase();
        if (methodParam === 'banking' || methodParam === 'momo') {
            const bc2 = document.getElementById('breadcrumb');
            if (bc2) {
                setTimeout(() => {
                    bc2.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 120);
            }
        }
        // Fallback: if server rendered a payment badge (variable `payment_method`), scroll as well
        if (!methodParam) {
            const badge = document.querySelector('.payment-method-badge');
            if (badge) {
                const bc3 = document.getElementById('breadcrumb');
                if (bc3) {
                    setTimeout(() => {
                        bc3.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 120);
                }
            }
        }
    } catch (err) {
        // ignore storage/errors
    }
});
</script>
{% endblock %}