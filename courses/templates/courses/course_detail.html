{% extends 'courses/base.html' %}

{% block content %}
<!-- Course Detail Section -->
<div class="course-detail-section">
    <div class="container">
        <!-- Breadcrumb t·ªëi ∆∞u nh·∫•t -->
        <div class="breadcrumb-optimized" id="breadcrumb">
            <div class="breadcrumb-nav">
                <a href="/" class="crumb-home">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span>Trang ch·ªß</span>
                </a>
                
                <div class="crumb-separator">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>
                
                <a href="/" class="crumb-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 19l7-7 3 3-7 7-7-7 3-3 4 4V4h2v16h-2z"></path>
                    </svg>
                    <span>Kh√≥a h·ªçc</span>
                </a>
                
                <div class="crumb-separator">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>
                
                <div class="crumb-current">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                    <span>{{ course.title|truncatechars:25 }}</span>
                </div>
            </div>
        </div>

        <!-- Course Main Content -->
        <div class="course-main-content">
            <!-- Left Column: Course Info -->
            <div class="course-info-column">
                <!-- Course Header -->
                <div class="course-header-detail">
                    <div class="course-category-tag">
                        {{ course.get_category_display|default:"L·∫≠p tr√¨nh" }}
                    </div>
                    <h1 class="course-title-detail">{{ course.title }}</h1>
                    
                    <div class="course-meta-info">
                        <div class="meta-item">
                            <span class="meta-icon">üìÖ</span>
                            <span>Ng√†y t·∫°o: {{ course.created_at|date:"d/m/Y" }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-icon">üë®‚Äçüéì</span>
                            <span>{{ course.enrollment_count|default:"0" }} h·ªçc vi√™n</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-icon">‚è±Ô∏è</span>
                            <span>{{ course.duration|default:"8 gi·ªù" }} h·ªçc</span>
                        </div>
                    </div>
                </div>
                
                <!-- Course Description -->
                <div class="course-description-box">
                    <div class="section-title">
                        <h3>üìñ M√¥ t·∫£ kh√≥a h·ªçc</h3>
                        <div class="title-line"></div>
                    </div>
                    <p class="course-full-description">{{ course.description|linebreaks }}</p>
                </div>
                
                <!-- Course Stats -->
                <div class="course-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <h4>ƒê√°nh gi√°</h4>
                            <div class="stat-value">{{ average_rating|floatformat:1 }}/5.0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-content">
                            <h4>B√†i h·ªçc</h4>
                            <div class="stat-value">{{ course.lesson_count|default:"12" }}</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-content">
                            <h4>C·∫•p ƒë·ªô</h4>
                            <div class="stat-value">{{ course.level|default:"C∆° b·∫£n" }}</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-content">
                            <h4>Ch·ª©ng ch·ªâ</h4>
                            <div class="stat-value">C√≥</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Course Actions & Price -->
            <div class="course-actions-column">
                <div class="course-price-card">
                    <!-- Price Display -->
                    <div class="price-display-main">
                        <div class="price-current">
                            <span class="price-amount">{{ course.price|floatformat:0 }}</span>
                            <span class="price-currency">VNƒê</span>
                        </div>
                        <div class="price-note">Gi√° ƒë√£ bao g·ªìm VAT</div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        {% if user.is_authenticated %}
                            {% if user_has_purchased %}
                                <a href="{% url 'learning_path' course.id %}" class="btn-learning-path">
                                    <span>üéØ</span>
                                    <span>V√†o h·ªçc ngay</span>
                                </a>
                            {% else %}
                                <form action="/add-to-cart/{{ course.id }}/" method="post" class="action-form">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-add-cart">
                                        <span>üõí</span>
                                        <span>Th√™m v√†o gi·ªè h√†ng</span>
                                    </button>
                                </form>
                                
                                <form action="/checkout-direct/{{ course.id }}/" method="post" class="action-form">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-buy-now">
                                        <span>‚ö°</span>
                                        <span>Mua ngay</span>
                                    </button>
                                </form>
                            {% endif %}
                        {% else %}
                            <div class="login-required-alert">
                                <div class="alert-icon">üîí</div>
                                <div class="alert-content">
                                    <h4>ƒêƒÉng nh·∫≠p ƒë·ªÉ mua kh√≥a h·ªçc</h4>
                                    <p>B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m kh√≥a h·ªçc v√†o gi·ªè h√†ng ho·∫∑c mua ngay.</p>
                                    <div class="auth-buttons">
                                        <a href="/accounts/login/" class="btn-login">üîê ƒêƒÉng nh·∫≠p</a>
                                        <a href="/accounts/signup/" class="btn-signup">üìù ƒêƒÉng k√Ω</a>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Course Features -->
                    <div class="course-features-list">
                        <h4>üéØ Kh√≥a h·ªçc bao g·ªìm:</h4>
                        <ul>
                            <li><span>‚úÖ</span> Video b√†i gi·∫£ng ch·∫•t l∆∞·ª£ng cao</li>
                            <li><span>‚úÖ</span> B√†i t·∫≠p th·ª±c h√†nh c√≥ ch·∫•m ƒëi·ªÉm</li>
                            <li><span>‚úÖ</span> T√†i li·ªáu h·ªçc t·∫≠p ƒë·∫ßy ƒë·ªß</li>
                            <li><span>‚úÖ</span> H·ªó tr·ª£ t·ª´ gi·∫£ng vi√™n 24/7</li>
                            <li><span>‚úÖ</span> Ch·ª©ng ch·ªâ ho√†n th√†nh c√≥ x√°c th·ª±c</li>
                            <li><span>‚úÖ</span> Truy c·∫≠p tr·ªçn ƒë·ªùi kh√≥a h·ªçc</li>
                        </ul>
                    </div>
                    
                    <!-- Back Button -->
                    <a href="/" class="btn-back-to-list">
                        <span>‚Üê</span>
                        <span>Quay l·∫°i danh s√°ch kh√≥a h·ªçc</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Reviews Section -->
        <div class="reviews-section-detail">
            <div class="section-title">
                <h2>‚≠ê ƒê√°nh gi√° kh√≥a h·ªçc</h2>
                <div class="title-line"></div>
            </div>
            
            <!-- Rating Summary -->
            <div class="rating-summary-card">
                <div class="rating-overview">
                    <div class="average-rating-display">
                        <div class="rating-number-large">{{ average_rating|floatformat:1 }}</div>
                        <div class="rating-stars-large">
                            {% for i in "12345" %}
                                {% if forloop.counter <= average_rating %}
                                    <span class="star-filled">‚òÖ</span>
                                {% else %}
                                    <span class="star-empty">‚òÜ</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="rating-count">{{ total_reviews }} ƒë√°nh gi√°</div>
                    </div>
                </div>
            </div>
            
            <!-- Review Form -->
            {% if user.is_authenticated and user_has_purchased and not user_review %}
            <div class="review-form-card">
                <h3>üìù Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n</h3>
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="rating-input-group">
                        <label>ƒê√°nh gi√° c·ªßa b·∫°n:</label>
                        <div class="star-rating-select">
                            {% for i in "54321" %}
                                <input type="radio" name="rating" value="{{ i }}" id="star{{ i }}">
                                <label for="star{{ i }}">‚≠ê</label>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="comment-input-group">
                        <textarea name="comment" placeholder="Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªÅ kh√≥a h·ªçc n√†y..." 
                                  required rows="4" maxlength="500"></textarea>
                        <div class="char-count"><span id="charCount">0</span>/500 k√Ω t·ª±</div>
                    </div>
                    
                    <button type="submit" class="btn-submit-review">
                        <span>üì§</span>
                        <span>G·ª≠i ƒë√°nh gi√°</span>
                    </button>
                </form>
            </div>
            {% elif user_review %}
            <div class="your-review-card">
                <h3>üìå ƒê√°nh gi√° c·ªßa b·∫°n</h3>
                <div class="review-item featured">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">{{ user.username|slice:":1"|upper }}</div>
                        <div class="reviewer-details">
                            <div class="reviewer-name">B·∫°n</div>
                            <div class="review-meta">
                                <div class="review-stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= user_review.rating %}
                                            <span class="star-filled">‚òÖ</span>
                                        {% else %}
                                            <span class="star-empty">‚òÜ</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div class="review-date">{{ user_review.created_at|date:"d/m/Y" }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="review-content">
                        <p>{{ user_review.comment }}</p>
                    </div>
                </div>
            </div>
            {% elif user.is_authenticated and not user_has_purchased %}
            <div class="purchase-notice">
                <div class="notice-icon">üìù</div>
                <div class="notice-content">
                    <h4>B·∫°n c·∫ßn mua kh√≥a h·ªçc n√†y ƒë·ªÉ ƒë√°nh gi√°</h4>
                    <p>H√£y mua kh√≥a h·ªçc v√† tr·∫£i nghi·ªám tr∆∞·ªõc khi chia s·∫ª ƒë√°nh gi√° c·ªßa b·∫°n.</p>
                </div>
            </div>
            {% endif %}
            
            <!-- Reviews List -->
            <div class="reviews-list-container">
                <h3>üí¨ ƒê√°nh gi√° t·ª´ h·ªçc vi√™n</h3>
                
                {% for review in reviews %}
                <div class="review-item">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">{{ review.user.username|slice:":1"|upper }}</div>
                        <div class="reviewer-details">
                            <div class="reviewer-name">{{ review.user.username }}</div>
                            <div class="review-meta">
                                <div class="review-stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= review.rating %}
                                            <span class="star-filled">‚òÖ</span>
                                        {% else %}
                                            <span class="star-empty">‚òÜ</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div class="review-date">{{ review.created_at|date:"d/m/Y" }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="review-content">
                        <p>{{ review.comment }}</p>
                    </div>
                </div>
                {% empty %}
                <div class="no-reviews-message">
                    <div class="no-reviews-icon">üí¨</div>
                    <h4>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o</h4>
                    <p>H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° kh√≥a h·ªçc n√†y!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
/* ===== VARIABLES ===== */
:root {
    --accent: #3b82f6;
    --accent-2: #6366f1;
    --success: #10b981;
    --text: #1e293b;
    --muted: #64748b;
    --bg: #f8fafc;
    --shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    --radius: 16px;
    --transition: all 0.3s ease;
}

/* ===== OPTIMIZED BREADCRUMB ===== */
.breadcrumb-optimized {
    margin-bottom: 2rem;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    transition: var(--transition);
}

/* Hi·ªáu ·ª©ng khi cu·ªôn */
.breadcrumb-optimized.sticky {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 0.25rem 0;
    background: rgba(255, 255, 255, 0.98);
}

.breadcrumb-nav {
    display: flex;
    align-items: center;
    background: white;
    border-radius: 12px;
    padding: 0.75rem 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    transition: var(--transition);
}

/* Khi breadcrumb sticky, l√†m nh·ªè l·∫°i */
.breadcrumb-optimized.sticky .breadcrumb-nav {
    padding: 0.5rem 1.25rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.crumb-home,
.crumb-link,
.crumb-current {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
}

.crumb-home,
.crumb-link {
    color: var(--accent);
}

.crumb-home:hover,
.crumb-link:hover {
    background: #f1f5f9;
    color: var(--accent-2);
    transform: translateY(-1px);
}

.crumb-current {
    color: var(--text);
    font-weight: 600;
    background: #f8fafc;
    cursor: default;
}

.crumb-separator {
    color: #cbd5e1;
    display: flex;
    align-items: center;
}

/* ===== COURSE DETAIL STYLES ===== */
.course-detail-section {
    background: var(--bg);
    min-height: 100vh;
    padding: 2rem 0;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
}

/* Main Content Layout */
.course-main-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 3rem;
    margin-bottom: 4rem;
}

/* Left Column - Course Info */
.course-header-detail {
    margin-bottom: 2.5rem;
}

.course-category-tag {
    display: inline-block;
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: white;
    padding: 0.5rem 1.25rem;
    border-radius: 50px;
    font-weight: 600;
    margin-bottom: 1rem;
}

.course-title-detail {
    font-size: 2.5rem;
    font-weight: 800;
    line-height: 1.2;
    color: var(--text);
    margin-bottom: 1.5rem;
}

.course-meta-info {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--muted);
    font-size: 0.95rem;
}

.meta-icon {
    font-size: 1.2rem;
}

/* Course Description */
.course-description-box {
    background: white;
    border-radius: var(--radius);
    padding: 2rem;
    box-shadow: var(--shadow);
    margin-bottom: 2.5rem;
}

.section-title {
    margin-bottom: 1.5rem;
    position: relative;
}

.section-title h2, 
.section-title h3 {
    font-size: 1.8rem;
    color: var(--text);
    margin-bottom: 0.75rem;
}

.title-line {
    width: 60px;
    height: 4px;
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    border-radius: 2px;
}

.course-full-description {
    color: var(--muted);
    line-height: 1.7;
    font-size: 1.05rem;
}

/* Course Stats Grid */
.course-stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: var(--radius);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: var(--transition);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
}

.stat-icon {
    font-size: 2.5rem;
    color: var(--accent);
}

.stat-content h4 {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 0.25rem;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
}

/* Right Column - Price & Actions */
.course-price-card {
    background: white;
    border-radius: var(--radius);
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    position: sticky;
    top: 2rem;
}

.price-display-main {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid #f1f5f9;
}

.price-current {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.price-amount {
    font-size: 3rem;
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.price-currency {
    font-size: 1.5rem;
    color: var(--muted);
    font-weight: 600;
}

.price-note {
    color: var(--muted);
    font-size: 0.9rem;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
}

.action-form {
    margin: 0;
}

.btn-add-cart,
.btn-buy-now,
.btn-learning-path {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1.25rem;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    width: 100%;
    text-align: center;
}

.btn-add-cart {
    background: linear-gradient(135deg, var(--success), #34d399);
    color: white;
}

.btn-add-cart:hover {
    background: linear-gradient(135deg, #0da271, #10b981);
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(16, 185, 129, 0.3);
}

.btn-buy-now {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
}

.btn-buy-now:hover {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(239, 68, 68, 0.3);
}

.btn-learning-path {
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: white;
    text-decoration: none;
}

.btn-learning-path:hover {
    background: linear-gradient(135deg, #2563eb, #4f46e5);
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(59, 130, 246, 0.3);
}

/* Login Required Alert */
.login-required-alert {
    background: #fef3c7;
    border: 2px solid #fbbf24;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
}

.alert-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.alert-content h4 {
    color: #92400e;
    margin-bottom: 0.5rem;
}

.alert-content p {
    color: #92400e;
    opacity: 0.8;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
}

.auth-buttons {
    display: flex;
    gap: 1rem;
}

.btn-login,
.btn-signup {
    flex: 1;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    transition: var(--transition);
}

.btn-login {
    background: var(--accent);
    color: white;
}

.btn-login:hover {
    background: #2563eb;
    transform: translateY(-2px);
}

.btn-signup {
    background: white;
    color: var(--accent);
    border: 2px solid var(--accent);
}

.btn-signup:hover {
    background: var(--accent);
    color: white;
    transform: translateY(-2px);
}

/* Course Features */
.course-features-list {
    margin-bottom: 2rem;
}

.course-features-list h4 {
    font-size: 1.2rem;
    color: var(--text);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.course-features-list ul {
    list-style: none;
    padding: 0;
}

.course-features-list li {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    color: var(--muted);
}

.course-features-list li span {
    color: var(--success);
    font-size: 1.1rem;
}

/* Back Button */
.btn-back-to-list {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent);
    text-decoration: none;
    font-weight: 600;
    padding: 1rem;
    border: 2px solid var(--accent);
    border-radius: 8px;
    text-align: center;
    justify-content: center;
    transition: var(--transition);
}

.btn-back-to-list:hover {
    background: var(--accent);
    color: white;
    transform: translateY(-2px);
}

/* ===== REVIEWS SECTION ===== */
.reviews-section-detail {
    background: white;
    border-radius: var(--radius);
    padding: 2.5rem;
    box-shadow: var(--shadow);
    margin-top: 2rem;
}

.rating-summary-card {
    background: linear-gradient(135deg, #f8fafc, #f1f5f9);
    border-radius: var(--radius);
    padding: 2rem;
    margin-bottom: 2rem;
}

.rating-overview {
    display: flex;
    justify-content: center;
}

.average-rating-display {
    text-align: center;
}

.rating-number-large {
    font-size: 4rem;
    font-weight: 800;
    color: var(--accent);
    line-height: 1;
}

.rating-stars-large {
    font-size: 2rem;
    margin: 1rem 0;
}

.star-filled {
    color: #fbbf24;
}

.star-empty {
    color: #e2e8f0;
}

.rating-count {
    color: var(--muted);
    font-size: 1.1rem;
}

/* Review Form */
.review-form-card {
    background: #f8fafc;
    border-radius: var(--radius);
    padding: 2rem;
    margin-bottom: 2rem;
}

.review-form-card h3 {
    color: var(--text);
    margin-bottom: 1.5rem;
}

.rating-input-group {
    margin-bottom: 1.5rem;
}

.rating-input-group label {
    display: block;
    margin-bottom: 0.75rem;
    color: var(--text);
    font-weight: 500;
}

.star-rating-select {
    display: flex;
    gap: 0.5rem;
}

.star-rating-select input {
    display: none;
}

.star-rating-select label {
    font-size: 2.5rem;
    cursor: pointer;
    transition: var(--transition);
    margin: 0;
}

.star-rating-select input:checked ~ label,
.star-rating-select label:hover,
.star-rating-select label:hover ~ label {
    color: #fbbf24;
}

.star-rating-select input:checked + label {
    color: #fbbf24;
}

.comment-input-group {
    margin-bottom: 1.5rem;
}

.comment-input-group textarea {
    width: 100%;
    padding: 1.25rem;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 1rem;
    resize: vertical;
    min-height: 120px;
    transition: var(--transition);
    font-family: inherit;
}

.comment-input-group textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.char-count {
    text-align: right;
    color: var(--muted);
    font-size: 0.9rem;
    margin-top: 0.5rem;
}

.btn-submit-review {
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    transition: var(--transition);
}

.btn-submit-review:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
}

/* Reviews List */
.reviews-list-container {
    margin-top: 2rem;
}

.reviews-list-container h3 {
    color: var(--text);
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
}

.review-item {
    background: #f8fafc;
    border-radius: var(--radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.review-item.featured {
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border: 2px solid #bae6fd;
}

.reviewer-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.reviewer-avatar {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
}

.reviewer-details {
    flex: 1;
}

.reviewer-name {
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.25rem;
}

.review-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.review-stars {
    display: flex;
    gap: 0.25rem;
}

.review-date {
    color: var(--muted);
    font-size: 0.9rem;
}

.review-content p {
    color: var(--text);
    line-height: 1.6;
    margin: 0;
}

/* No Reviews */
.no-reviews-message {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--muted);
}

.no-reviews-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    opacity: 0.5;
}

.no-reviews-message h4 {
    color: var(--text);
    margin-bottom: 0.5rem;
}

/* Purchase Notice */
.purchase-notice {
    background: #fef3c7;
    border-radius: var(--radius);
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
}

.notice-icon {
    font-size: 2rem;
}

.notice-content h4 {
    color: #92400e;
    margin-bottom: 0.25rem;
}

.notice-content p {
    color: #92400e;
    opacity: 0.8;
    margin: 0;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1024px) {
    .course-main-content {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .course-price-card {
        position: static;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 0 1rem;
    }
    
    .course-title-detail {
        font-size: 2rem;
    }
    
    .course-meta-info {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .course-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .stat-card {
        padding: 1.25rem;
    }
    
    .price-amount {
        font-size: 2.5rem;
    }
    
    .auth-buttons {
        flex-direction: column;
    }
    
    .rating-number-large {
        font-size: 3rem;
    }
    
    .rating-stars-large {
        font-size: 1.5rem;
    }
    
    .reviews-section-detail {
        padding: 1.5rem;
    }
    
    /* Responsive breadcrumb */
    .breadcrumb-nav {
        padding: 0.75rem 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .crumb-home span,
    .crumb-link span,
    .crumb-current span {
        display: none;
    }
    
    .crumb-home,
    .crumb-link,
    .crumb-current {
        padding: 0.5rem;
    }
}
/* ===== NOTIFICATION STYLES ===== */
.custom-notification {
    position: fixed;
    top: 100px;
    right: 20px;
    z-index: 9999;
    background: white;
    border-radius: 12px;
    padding: 15px 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    border-left: 4px solid var(--success);
    transform: translateX(120%);
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    min-width: 300px;
    max-width: 400px;
}

.custom-notification.error {
    border-left-color: var(--danger);
}

.custom-notification.warning {
    border-left-color: var(--warning);
}

.custom-notification.show {
    transform: translateX(0);
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.notification-icon {
    font-size: 1.5rem;
}

.notification-text {
    font-weight: 500;
    color: var(--text);
    flex: 1;
}
</style>

<script>
// AJAX for add to cart
document.addEventListener('DOMContentLoaded', function() {
    const addToCartForm = document.querySelector('form[action*="add-to-cart"]');
    
    if (addToCartForm) {
        addToCartForm.addEventListener('submit', function(e) {
            e.preventDefault(); // NgƒÉn form submit b√¨nh th∆∞·ªùng
            
            const formData = new FormData(this);
            const url = this.action;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            // Hi·ªÉn th·ªã loading indicator
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            const originalBg = submitBtn.style.background;
            submitBtn.innerHTML = '<span>üîÑ</span><span>ƒêang th√™m...</span>';
            submitBtn.disabled = true;
            
            // G·ª≠i AJAX request
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // X·ª≠ l√Ω response
                if (data.success) {
                    // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                    showNotification('‚úÖ ' + data.message, 'success');
                    
                    // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng
                    updateCartCount(data.cart_count);
                    
                    // Thay ƒë·ªïi button th√†nh "ƒê√£ th√™m" t·∫°m th·ªùi
                    submitBtn.innerHTML = '<span>‚úÖ</span><span>ƒê√£ th√™m</span>';
                    submitBtn.style.background = 'linear-gradient(135deg, #10b981, #34d399)';
                    
                    // Sau 2 gi√¢y ƒë·ªïi l·∫°i button ban ƒë·∫ßu
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.style.background = originalBg;
                        submitBtn.disabled = false;
                    }, 2000);
                } else {
                    // Hi·ªÉn th·ªã th√¥ng b√°o c·∫£nh b√°o
                    showNotification('‚ö†Ô∏è ' + data.message, 'warning');
                    
                    // Kh√¥i ph·ª•c button
                    submitBtn.innerHTML = originalText;
                    submitBtn.style.background = originalBg;
                    submitBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('‚ùå C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!', 'error');
                
                // Kh√¥i ph·ª•c button
                submitBtn.innerHTML = originalText;
                submitBtn.style.background = originalBg;
                submitBtn.disabled = false;
            });
        });
    }
});

// H√†m hi·ªÉn th·ªã th√¥ng b√°o
function showNotification(message, type = 'success') {
    // X√≥a th√¥ng b√°o c≈© n·∫øu c√≥
    const oldNotification = document.querySelector('.custom-notification');
    if (oldNotification) {
        oldNotification.remove();
    }
    
    // T·∫°o th√¥ng b√°o m·ªõi
    const notification = document.createElement('div');
    notification.className = `custom-notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-icon">${type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚úÖ'}</span>
            <span class="notification-text">${message}</span>
        </div>
    `;
    
    // Th√™m v√†o body
    document.body.appendChild(notification);
    
    // Hi·ªáu ·ª©ng xu·∫•t hi·ªán
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 3000);
}

// H√†m c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng
function updateCartCount(count) {
    // T√¨m c√°c ph·∫ßn t·ª≠ hi·ªÉn th·ªã s·ªë l∆∞·ª£ng gi·ªè h√†ng
    const cartCountElements = document.querySelectorAll('.cart-count, .cart-badge, .cart-item-count');
    
    cartCountElements.forEach(element => {
        element.textContent = count;
        element.style.display = count > 0 ? 'flex' : 'none';
    });
    
    // N·∫øu kh√¥ng c√≥ ph·∫ßn t·ª≠ n√†o, c√≥ th·ªÉ t·∫°o m·ªõi
    if (cartCountElements.length === 0) {
        // T√¨m link gi·ªè h√†ng v√† th√™m badge
        const cartLink = document.querySelector('a[href*="cart"]');
        if (cartLink) {
            let badge = cartLink.querySelector('.cart-badge');
            if (!badge) {
                badge = document.createElement('span');
                badge.className = 'cart-badge';
                badge.style.cssText = `
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    background: #ef4444;
                    color: white;
                    border-radius: 50%;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    font-weight: bold;
                `;
                cartLink.style.position = 'relative';
                cartLink.appendChild(badge);
            }
            badge.textContent = count;
            badge.style.display = count > 0 ? 'flex' : 'none';
        }
    }
}
// Character counter for review textarea
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.querySelector('textarea[name="comment"]');
    const charCount = document.getElementById('charCount');
    
    if (textarea && charCount) {
        textarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
        
        // Initialize count
        charCount.textContent = textarea.value.length;
    }
    
    // Star rating interaction
    const starLabels = document.querySelectorAll('.star-rating-select label');
    starLabels.forEach(label => {
        label.addEventListener('click', function() {
            const ratingValue = this.htmlFor.replace('star', '');
            console.log('Selected rating:', ratingValue);
        });
    });
    
    // Sticky breadcrumb effect
    const breadcrumb = document.getElementById('breadcrumb');
    
    window.addEventListener('scroll', function() {
        if (window.scrollY > 50) {
            breadcrumb.classList.add('sticky');
        } else {
            breadcrumb.classList.remove('sticky');
        }
    });
});
</script>
{% endblock %}